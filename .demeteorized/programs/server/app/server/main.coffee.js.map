{"version":3,"file":"/server/main.coffee.js","sources":["main.coffee"],"names":[],"mappings":"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","sourcesContent":["uuuRl = undefined\n# val = 0 - (NWlng - lon0)\nvalY = undefined\n@arrayOfObj = []\nurlE = undefined\n@val = 0.003\n# val = undefined\nisOdd = (num) ->\n console.log num % 2\n\nmarkerObject = (latData, lngData, name, tel, factual_id, region, postcode, fax, url, yelp) ->\n  {lat: latData, lng: lngData, name: name, tel: tel, factual_id: factual_id, region: region, postcode: postcode, fax: fax, url: url, yelp: yelp}\n\nlat0 = undefined\nlon0 = undefined\nNWlat = undefined\nNWlng = undefined\nfactualCrawl = (NWlng, NWlat, SElng, SElat) ->\n  console.log 'factualCrawl'\n    # test define center of a c\n  # console.log SElng - NWlng\n  # console.log SElat + NWlat\n  lat3 = undefined\n  lon3 = undefined\n  dLon = undefined\n  dLat = undefined\n  dLon = undefined\n  R = undefined\n  a = undefined\n  c = undefined\n  d = undefined\n  brng = undefined\n  Bx = undefined\n  By = undefined\n  marker = undefined\n  markeru = undefined\n\n  toRad = (Value) ->\n    Value * Math.PI / 180\n\n  bearing = () ->\n    y = Math.sin(dLon) * Math.cos(SElat)\n    x = Math.cos(NWlat) * Math.sin(SElat) - Math.sin(NWlat) * Math.cos(SElat) * Math.cos(dLon)\n    brng = toRad(Math.atan2(y, x))\n    console.log \"brng\" + brng\n\n  # calcul distance\n  R = 6371\n  dLat = toRad(val)\n  dLon = toRad(val)\n  a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(toRad(NWlat)) * Math.cos(toRad(SElat)) * Math.sin(dLon / 2) * Math.sin(dLon / 2)\n  c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))\n  d = (R * c) * 1000\n  console.log 'this is distance in meter' + ' ' + d\n  #Create point between the two points to define the center of circle inside\n  console.log lat3 = NWlat - 0.01\n  console.log lon3 = NWlng + 0.01\n  aaa = \"this is middle\"\n\n  # get data from Factual\n  # keyFactual = 'Y1irlCd3KfTm113yFd3GVlDzkGvtbzU5nqNteLqZ'\n  # filterInJson = '{\"$circle\":{\"$center\":[#{lat3},#{lon3}],\"$meters\":#{d}}}' + '?filters={category_ids:{\"$includes\":123}}'\n  # objectFilter = EJSON.stringify(filterInJson)\n  # newtest = EJSON.parse objectFilter\n  # console.log newtest\n  # urlFac = \"http://api.v3.factual.com/t/restaurants-us?geo=\" + newtest + \"&KEY=#{keyFactual}\"\n  # console.log urlFac\n  # console.log A\n  Factual = undefined\n  factual = undefined\n  Factual = Meteor.npmRequire(\"factual-api\")\n  factual = new Factual(\"Y1irlCd3KfTm113yFd3GVlDzkGvtbzU5nqNteLqZ\", \"nAYWpc1AZx6TwdsmwwpxT526Oq6YqSMjiE4ERKuV\")\n  factual.get \"/t/places-us\",\n    geo:\n      $circle:\n        $center: [\n          lat3\n          lon3\n        ]\n        $meters: d\n  # , (error, res) ->\n  #   console.log res.data\n  #   return\n\n  , Meteor.bindEnvironment (error, res) ->\n    console.log res.data\n    # Markers.insert(markerObject(-118.419078, 34.058629))\n    # markeru = Markers.findOne({lng: 34.058629})\n    # console.log markeru\n    # Markers.update\n    #   _id: markeru._id\n    # ,\n    #   yelp: true,\n    #   name: \"test\"\n    #   lng: -118.419078\n    #   lat: 34.058629\n    lengthOfJson = res.data.length\n    limit = lengthOfJson - 1\n    for i in [0...limit]\n      # console.log res.data\n      console.log country = res.data[i].country\n      console.log latFactual = res.data[i].latitude\n      console.log lonFactual = res.data[i].longitude\n      console.log name = res.data[i].name\n      console.log tel = res.data[i].tel\n      console.log factual_id = res.data[i].factual_id\n      console.log region = res.data[i].region\n      console.log postcode = res.data[i].postcode\n      console.log fax = res.data[i].fax\n      yelp = false\n      url = undefined\n      Markers.insert(markerObject(latFactual, lonFactual, name, tel, factual_id, region, postcode, fax, url, yelp))\n      marker = Markers.findOne({lat: latFactual, lng: lonFactual, yelp: true})\n      if marker is undefined\n        console.log 'not this one'\n      else\n        console.log 'here is marker' + marker._id + name + tel + factual_id + region + postcode + fax + url + yelp\n        yelp = true\n        Markers.update\n          _id: marker._id\n        ,\n          lat: latFactual\n          lng: lonFactual\n          name: name\n          tel: tel\n          factual_id: factual_id\n          region: region\n          postcode: postcode\n          fax: fax\n          yelp: yelp\n\nurlMaker = (SElng, SElat, NWlng, NWlat) ->\n  console.log 'urlMaker'\n  boundlnglat = SElng + \",\" + SElat + \",\" + NWlng + \",\" + NWlat\n  urlTo =  \"http://www.yelp.com/search?find_desc=&find_loc=shopping&l=g:\" + boundlnglat\n  return uuuRl = encodeURI urlTo\n\nlonN = undefined\nlatN = undefined\nlonNn = undefined\nlatNn = undefined\nyelpCrawl = (NWlng, NWlat, SElng, SElat, uuuRl) ->\n  console.log 'yelpCrawl'\n  cleanS = undefined\n  scrap = [{}]\n  markers = [{}]\n  location = [{}]\n  url = [{}]\n  country = undefined\n  latFactual = undefined\n  lonFactual = undefined\n  name = undefined\n  tel = undefined\n  factual_id = undefined\n  region = undefined\n  postcode = undefined\n  fax = undefined\n  clean = (txt) ->\n    chr = ['\\\\']\n    i = 0\n    while i <= 0\n      cleanS = txt.split(chr[i]).join(\"\")\n      i++\n  $ = Meteor.http.get uuuRl\n  console.log $\n  b = JSON.stringify($);\n  # console.log b\n  numberOfPages = b.indexOf(\"prev-next\");\n  data = b.substring(numberOfPages - 109, numberOfPages)\n  # console.log data\n  numbOf = data.charAt(0)\n  # console.log numbOf\n  n = b.indexOf(\"]}}}\");\n  m = b.indexOf(\"latitude\")\n  res = b.substring(m, n + 4);\n  o = res.indexOf(\"zoom\");\n  console.log better = res.substring(o + 13);\n  clean('{' + better + '}')\n  scrap = EJSON.parse(cleanS)\n  console.log scrap\n  a = scrap.markers\n  console.log a\n  length = (Object.keys(a).length)\n\n  console.log indexForThatStringInit = b.indexOf('Page 1 of') + 9\n  console.log indexForThatStringEnd  = indexForThatStringInit + 5\n  console.log thatString = b.substring(indexForThatStringInit, indexForThatStringEnd)\n  console.log numberOfPagesAvailable = parseInt(thatString)\n  for i in [1...length]\n    latData = a[i].location.latitude\n    lngData = a[i].location.longitude\n    urli = a[i].url\n    yelp = true\n    Markers.insert(markerObject(latData, lngData, name, tel, factual_id, region, postcode, fax, urli, yelp))\n    console.log urli + \" \" + latData + \" \" + lngData\n    console.log('end')\n    factualCrawl(NWlng, NWlat, SElng, SElat)\n\ncrawler = () ->\n  console.log 'crawler'\n  array = Bounds.find().fetch()\n  for key, object of array\n    # console.log object.marker0[0] + \"it goes here\"\n    # urLoop = urlMaker(object.marker0[0], object.marker0[1], object.marker1[1], object.marker1[0])\n    # console.log urLoop\n    yelpCrawl(object.NW[0], object.NW[1], object.SE[0], object.SE[1], object.url)\n\n@latN0 = undefined\n@lonN0 = undefined\n@latN1 = undefined\n@lonN1 = undefined\narrayOfObj = []\nsaveBound = (NWlng, NWlat, SElng, SElat, url, type) ->\n  console.log 'saveBound'\n  if type = \"db\"\n    Bounds.insert {\n      NW: [NWlng, NWlat]\n      SE: [SElng, SElat]\n      url: url\n    }\n  if type = \"ar\"\n    arrayOfObj.push {\n      NW: [NWlng, NWlat]\n      SE: [SElng, SElat]\n      url: url\n    }\n\nnorthToSouth = (latLim) ->\n  console.log 'southToNord'\n  for key, object of arrayOfObj\n    if object.SE[1] > latLim\n      console.log 'after for'\n      NWlng = object.NW[0]\n      NWlat = object.NW[1] - val\n      SElng = object.SE[0]\n      SElat = object.SE[1] - val\n      urlE = urlMaker(SElng, SElat, NWlng, NWlat)\n      saveBound(SElng, SElat, NWlng, NWlat, urlE, \"db\")\n      saveBound(SElng, SElat, NWlng, NWlat, \"ar\")\n      eastToWest(latLim)\n      northToSouth(latLim)\n    else\n      crawler()\n\nlast = undefined\neastToWest = (lonLim, latLim) ->\n  console.log 'eastToWest'\n  last = arrayOfObj[-1..]\n  console.log last\n  for key, object of last\n    if object.SE[0] < lonLim\n      console.log 'after for'\n      NWlng = object.NW[0] + val\n      NWlat = object.NW[1]\n      SElng = object.SE[0] + val\n      SElat = object.SE[1]\n      urlE = urlMaker(SElng, SElat, NWlng, NWlat)\n      saveBound(SElng, SElat, NWlng, NWlat, urlE, \"db\")\n      saveBound(SElng, SElat, NWlng, NWlat, urlE, \"ar\")\n      eastToWest(lonLim, latLim)\n    else\n      northToSouth(latLim)\n\nmakeSearch = (lonLim, latLim) ->\n  console.log 'makeSearch'\n  return eastToWest(lonLim, latLim)\n# array = undefined\ninitSearch = () ->\n  console.log 'initSearch'\n  array = Searchs.find().fetch()\n  for key, object of array\n    assocLng = object.NW[0] + val\n    assocLat = object.SE[1] - val\n    url1 = urlMaker(assocLng, assocLat, object.NW[0], object.NW[1])\n    arrayOfObj.push {\n      NW: [object.NW[0], object.NW[1]]\n      SE: [assocLng, assocLat]\n      url: url1\n    }\n    makeSearch(object.SE[0], object.SE[1])\nobserveSearchs = () ->\n  count = 0\n  query = Searchs.find({})\n  handle = query.observeChanges(\n    added: (id, user) ->\n      count++\n      console.log count\n      initSearch()\n      return\n\n    removed: ->\n      count--\n      console.log \"Lost one. We're now down to \" + count + \" admins.\"\n      return\n  )\n\nobserveSearchs()"]}